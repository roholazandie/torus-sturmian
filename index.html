<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sturmian Word on 3D Torus</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Sturmian Word on 3D Torus</h1>
        <p class="subtitle">
            Watch a particle trace a path on a 3D torus: 0 for major circle crossings, 1 for minor circle crossings
        </p>

        <!-- Sequence Display -->
        <div class="sequence-display">
            <div class="sequence-header">
                <h2>Sturmian Sequence</h2>
                <span class="sequence-length">Length: <span id="sequenceLength">0</span></span>
            </div>
            <div class="sequence-output" id="sequenceOutput">
                Press Start to begin...
            </div>
        </div>

        <!-- Unique N-Words Display -->
        <div class="nwords-display">
            <div class="nwords-header">
                <h2>Unique N-Words</h2>
                <div class="nwords-controls">
                    <label for="nwordsLength">N-word length:</label>
                    <select id="nwordsLength" class="nwords-select">
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                    <span class="nwords-count">Count: <span id="nwordsCount">0</span></span>
                </div>
            </div>
            <div class="nwords-output" id="nwordsOutput">
                Press Start to begin...
            </div>
        </div>

        <!-- Both Canvases Side by Side -->
        <div class="canvases-wrapper">
            <!-- 3D Torus Canvas -->
            <div class="canvas-section">
                <h3>3D Torus</h3>
                <div class="canvas-container">
                    <canvas id="canvas" width="400" height="400"></canvas>
                </div>
            </div>

            <!-- Unwrapped Torus View -->
            <div class="canvas-section">
                <h3>Unwrapped Torus (Fundamental Domain)</h3>
                <div class="canvas-container">
                    <canvas id="unwrappedCanvas" width="400" height="400"></canvas>
                </div>
            </div>
        </div>

        <!-- Mode Toggle -->
        <div class="control-panel">
            <label class="control-label">Input Mode</label>
            <div class="mode-toggle">
                <button class="mode-button active" id="irrationalMode" onclick="setMode(false)">
                    Irrational (Slope)
                </button>
                <button class="mode-button" id="rationalMode" onclick="setMode(true)">
                    Rational (p/q)
                </button>
            </div>
        </div>

        <!-- Irrational Input -->
        <div class="control-panel" id="irrationalPanel">
            <label class="control-label">
                Slope (irrational): <span id="tangentValue">1.618000</span>
            </label>
            <div class="slider-row">
                <input type="range" class="slider" id="tangentSlider"
                       min="0.001" max="10" step="0.001" value="1.618">
                <input type="number" class="number-input" id="tangentInput"
                       min="0.001" max="1000" step="any" value="1.618">
            </div>
            <div class="preset-buttons">
                <button class="preset-button" onclick="setTangent(Math.sqrt(2))">
                    √2 ≈ 1.414
                </button>
                <button class="preset-button" onclick="setTangent((1 + Math.sqrt(5)) / 2)">
                    φ ≈ 1.618
                </button>
                <button class="preset-button" onclick="setTangent(Math.PI)">
                    π ≈ 3.142
                </button>
            </div>
        </div>

        <!-- Rational Input -->
        <div class="control-panel" id="rationalPanel" style="display: none;">
            <label class="control-label">
                Rational Ratio: <span id="ratioDisplay">2/5 = 0.400000</span>
            </label>
            <div class="ratio-inputs">
                <div class="input-group">
                    <label>p (numerator)</label>
                    <input type="number" class="number-input" id="pInput"
                           min="1" max="100" step="1" value="2">
                </div>
                <div class="input-group">
                    <label>q (denominator)</label>
                    <input type="number" class="number-input" id="qInput"
                           min="1" max="100" step="1" value="5">
                </div>
            </div>
            <div class="preset-buttons">
                <button class="preset-button" onclick="setRatio(2, 3)">2/3</button>
                <button class="preset-button" onclick="setRatio(3, 5)">3/5</button>
                <button class="preset-button" onclick="setRatio(5, 8)">5/8</button>
                <button class="preset-button" onclick="setRatio(8, 13)">8/13</button>
            </div>
        </div>

        <!-- Speed Control -->
        <div class="control-panel">
            <label class="control-label">
                Speed: <span id="speedValue">5.0</span>x
            </label>
            <input type="range" class="slider" id="speedSlider"
                   min="1" max="100" step="1" value="5">
            <div class="speed-labels">
                <span>1x</span>
                <span>50x</span>
                <span>100x</span>
            </div>
        </div>

        <!-- Trace Toggle -->
        <div class="control-panel">
            <label class="checkbox-container">
                <input type="checkbox" class="checkbox" id="showTrace" checked>
                <span>Show Trace Path</span>
            </label>
            <label class="checkbox-container" style="margin-top: 10px;">
                <input type="checkbox" class="checkbox" id="enableRecording">
                <span>Record Animation</span>
            </label>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-button start" id="startBtn" onclick="handleStart()">
                ▶ Start
            </button>
            <button class="action-button stop" id="stopBtn" onclick="handleStop()" style="display: none;">
                ⏸ Stop
            </button>
            <button class="action-button reset" onclick="handleReset()">
                ↺ Reset
            </button>
        </div>

        <!-- Information -->
        <div class="info-panel">
            <h3>About 3D Torus Sturmian Words</h3>
            <p>
                The particle moves on a 3D torus with parametric equations: θ₁(t) = t and θ₂(t) = slope·t.
                You can use either an irrational slope (like √2, φ, or π) or a rational ratio p/q.
            </p>
            <p>
                When the slope is <strong>irrational</strong>, the path never repeats and creates an aperiodic
                Sturmian sequence. When it's <strong>rational (p/q)</strong>, the path closes after q loops
                around the major circle and p loops around the minor circle, creating a periodic sequence.
            </p>
    </div>

    <script src="script.js"></script>
</body>
</html>